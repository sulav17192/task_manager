<div class="container">
  <h1 class="mb-4">Tasks</h1>

  <table class="table table-striped table-hover">
    <thead class="table-dark">
      <tr>
        <th>Title</th>
        <th>Description</th>
        <th>Due Date</th>
        <th>Status</th>
        <th>Assigned To</th>
        <th>Created By</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @tasks.each do |task| %>
        <tr>
          <td><%= task.title %></td>
          <td><%= task.description %></td>
          <td><%= task.due_date %></td>
          <td>
            <% if task.completed? %>
              <span class="badge bg-success">Completed</span>
            <% else %>
              <span class="badge bg-warning text-dark">Pending</span>
            <% end %>
          </td>
          <td><%= task.assigned_to&.email || "Unassigned" %></td>
          <td><%= task.creator.email %></td>
          <td>
            <%= link_to "Show", task, class: "btn btn-sm btn-primary" %>
            <% if policy(task).update? %>
              <%= link_to "Edit", edit_task_path(task), class: "btn btn-sm btn-secondary" %>
            <% end %>
            <% if policy(task).destroy? %>
              <%= link_to "Delete", task, data: { turbo_method: :delete, confirm: "Are you sure?" }, class: "btn btn-sm btn-danger" %>
            <% end %>
            <% if policy(task).mark_complete? && task.pending? %>
              <%= button_to "Mark Complete", mark_complete_task_path(task), method: :patch, class: "btn btn-sm btn-success" %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <% if policy(Task).create? %>
    <%= link_to "New Task", new_task_path, class: "btn btn-primary" %>
  <% end %>
</div>
